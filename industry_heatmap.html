<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISM Manufacturing Industry Heatmap</title>
    <meta name="deployment-version" content="auto-updated-2026-01-06-2145">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding: 20px;
            background-color: #f8f9fa;
            color: #333;
        }

        h1,
        h2 {
            color: #2c3e50;
            text-align: center;
        }

        h2 {
            margin-top: 60px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            display: inline-block;
        }

        /* Container for scrolling with shadow hints could be added here if we wrapped tables */

        table {
            border-collapse: separate;
            /* reliably supports sticky headers/columns */
            border-spacing: 0;
            width: 100%;
            margin: 20px auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            background-color: white;
            font-size: 0.9em;
            border-radius: 8px;
        }

        th,
        td {
            padding: 12px 15px;
            text-align: center;
            border-bottom: 1px solid #eee;
            /* Removed vertical borders for cleaner look */
        }

        /* Sticky Header (General) */
        th {
            background-color: #2c3e50;
            color: white;
            font-weight: 600;
            position: sticky;
            top: 0;
            z-index: 20;
            /* Increased from 10 */
            box-shadow: 0 2px 2px -1px rgba(0, 0, 0, 0.2);
            border-bottom: none;
            /* Shadow handles separation */
        }

        /* Strong Row Hover Highlight */
        tr:hover td {
            /* Distinct darker overlay that works over heatmap colors */
            box-shadow: inset 0 0 0 9999px rgba(0, 0, 0, 0.15) !important;
            cursor: w-resize;
            /* Hint that you can slide */
            transition: box-shadow 0.1s ease;
            /* background-color: transparent; REMOVED: Caused sticky columns to be transparent */
            /* Override any bg color */
        }

        /* Essential: Apply highlight to sticky columns while KEEPING their drop shadow AND opaque background */
        /* Use opaque colors instead of inset shadows to prevent transparency issues */

        /* Normal State: Odd = White, Even = Light Gray */
        tbody tr:nth-child(odd) .industry-col,
        tbody tr:nth-child(odd) .metric-col {
            background-color: #fff;
        }

        tbody tr:nth-child(even) .industry-col,
        tbody tr:nth-child(even) .metric-col {
            background-color: #f9f9f9;
        }

        /* Hover State: Darker Opaque Gray for ALL sticky columns */
        /* This simulates the shadow effect but ensures the element is solid */
        tbody tr:hover .industry-col,
        tbody tr:hover .metric-col {
            background-color: #e2e6ea !important;
            /* Matches hover darkness approx */
            box-shadow: 2px 0 5px -2px rgba(0, 0, 0, 0.1) !important;
            /* Keep the right-side drop shadow */
        }

        /* Regular data cells still use the shadow method (optional, or we could change them too) */
        tr:hover td:not(.industry-col):not(.metric-col) {
            box-shadow: inset 0 0 0 9999px rgba(0, 0, 0, 0.15);
            cursor: w-resize;
            transition: box-shadow 0.1s ease;
        }

        /* Sticky First Columns (Industry/Metric) - Restored Layout */
        .industry-col,
        .metric-col {
            text-align: left;
            font-weight: 600;
            width: 260px;
            position: sticky;
            left: 0;
            z-index: 15;
            /* Increased from 5 to sit above default content (0) and below headers (20) */
            border-right: 1px solid #ddd;
        }

        /* The Intersection (Top Left) - Needs Highest Z-Index */
        th.industry-col,
        th.metric-col {
            z-index: 30;
            /* Increased from 20 to sit above everything */
            background-color: #2c3e50;
            /* Match header color */
            color: white;
            border-right: 1px solid #3d566e;
            /* Subtle separator for the dark header */
        }

        /* Zebra Stripping for the rest of the row */
        tbody tr:nth-child(even) {
            background-color: #fafafa;
        }

        .date-header {
            width: 80px;
            font-size: 0.85em;
            line-height: 1.3;
            padding: 8px 5px;
            vertical-align: bottom;
        }

        /* Legend Styling */
        .legend {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 30px auto;
            font-size: 0.9em;
            background: white;
            padding: 15px;
            border-radius: 50px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            width: fit-content;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 500;
        }

        .color-box {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            border: none;
        }

        .trend-contraction {
            color: #e74c3c;
            font-weight: 700;
        }

        .trend-expansion {
            color: #2ecc71;
            font-weight: 700;
        }

        .summary-box {
            background-color: #fff;
            border-left: 5px solid #3498db;
            padding: 20px;
            margin: 15px auto 50px auto;
            max-width: 95%;
            border-radius: 0 4px 4px 0;
            color: #444;
            line-height: 1.6;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .summary-title {
            text-transform: uppercase;
            font-size: 0.8em;
            letter-spacing: 0.5px;
        }

        .back-nav {
            margin-bottom: 20px;
        }

        .back-nav a {
            text-decoration: none;
            color: #64748b;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-family: 'Segoe UI', sans-serif;
            font-size: 0.95rem;
            transition: color 0.2s ease;
        }

        .back-nav a:hover {
            color: #1e293b;
            text-decoration: underline;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
</head>

<body>

    <div class="back-nav">
        <a href="index.html">‚Üê Back to Financial Dashboard</a>
    </div>

    <h1>ISM Manufacturing Industry Trends (Nov '24 - Nov '25)</h1>

    <div style="text-align: center; margin-bottom: 20px;">
        <a href="industry_comments.html"
            style="color: #4CAF50; text-decoration: none; font-size: 1.1em; font-weight: bold;">View Respondent Comments
            &rarr;</a>
    </div>

    <div class="legend">
        <div class="legend-item">
            <div class="color-box" style="background-color: #2ecc71;"></div> Strong Growth
        </div>
        <div class="legend-item">
            <div class="color-box" style="background-color: #ffff99;"></div> Stable (0)
        </div>
        <div class="legend-item">
            <div class="color-box" style="background-color: #e74c3c;"></div> Strong Contraction
        </div>
    </div>

    <table id="heatmapTable">
        <thead>
            <tr id="headerRow">
                <th class="industry-col">Industry</th>
                <!-- Months will be populated by JS -->
            </tr>
        </thead>
        <tbody id="tableBody">
            <!-- Data rows will be populated by JS -->
        </tbody>
    </table>

    <div class="summary-box">
        <span class="summary-title">Key Insights</span>
        <p><strong>Top 3 Industries with Longest Periods of Growth:</strong></p>
        <ul style="margin: 5px 0 15px 20px;">
            <li><strong>Electrical Equipment, Appliances & Comp</strong> (8 months)</li>
            <li><strong>Nonmetallic Mineral Products</strong> (6 months)</li>
            <li><strong>Petroleum & Coal Products</strong> (6 months)</li>
        </ul>

        <p><strong>Top 3 Industries with Longest Periods of Contraction:</strong></p>
        <ul style="margin: 5px 0 15px 20px;">
            <li><strong>Paper Products</strong> (10 months)</li>
            <li><strong>Wood Products</strong> (10 months)</li>
            <li><strong>Chemical Products</strong> (8 months)</li>
        </ul>

        <p><strong>Industries Moving from Contraction to Growth (Latest Report):</strong> None in the latest report.</p>
        <p><strong>Industries Moving from Growth to Contraction (Latest Report):</strong> <strong>Machinery</strong>,
            <strong>Miscellaneous Manufacturing</strong> have reversed course, indicating emerging headwinds.</p>
    </div>

    <h2>New Orders Industry Growth Rank</h2>
    <table id="rankTable">
        <thead>
            <tr id="rankHeaderRow">
                <th class="industry-col">Industry</th>
                <!-- Months populated by JS -->
            </tr>
        </thead>
        <tbody id="rankTableBody"></tbody>
    </table>

    <div class="summary-box">
        <span class="summary-title">Key Insights - New Orders</span>
        <p><strong>Top 3 Industries with Longest Periods of New Orders Growth:</strong></p>
        <ul style="margin: 5px 0 15px 20px;">
            <li><strong>Petroleum & Coal Products</strong> (6 months)</li>
            <li><strong>Electrical Equipment, Appliances & Comp</strong> (5 months)</li>
            <li><strong>Primary Metals</strong> (5 months)</li>
        </ul>

        <p><strong>Top 3 Industries with Longest Periods of New Orders Contraction:</strong></p>
        <ul style="margin: 5px 0 15px 20px;">
            <li><strong>Nonmetallic Mineral Products</strong> (4 months)</li>
            <li><strong>Furniture & Related Products</strong> (4 months)</li>
            <li><strong>Machinery</strong> (3 months)</li>
        </ul>

        <p><strong>Industries Moving from Contraction to Growth (Latest Report):</strong> None in the latest report.</p>
        <p><strong>Industries Moving from Growth to Contraction (Latest Report):</strong> None in the latest report.</p>
    </div>

    <h2 id="pmiHeader">ISM Manufacturing PMI Data</h2>
    <table id="pmiTable">
        <thead>
            <tr id="pmiHeaderRow">
                <th class="metric-col">Metric</th>
                <!-- Dates will be populated by JS -->
            </tr>
        </thead>
        <tbody id="pmiBody"></tbody>
    </table>

    <div class="summary-box">
        <span class="summary-title">Key Insights</span>
        The broader manufacturing sector remains in <strong>Contraction territory</strong> (PMI < 50) for the majority
            of 2025, with brief expansionary readings only in January and February. While <strong>Prices</strong> have
            remained elevated (indices > 60 in mid-2025), indicating persistent inflationary pressure, critical metrics
            like <strong>Production</strong> and <strong>New Orders</strong> have largely hovered below or near the
            stagnation point (50), reflecting a cautious industrial environment.
    </div>

    <h2 style="margin-top: 40px;">Trend Charts</h2>
    <p style="text-align: center; color: #666; font-size: 0.9em; margin-bottom: 10px;">
        üí° <em>Scroll to zoom, drag to pan, double-click to reset</em>
    </p>
    <div style="display: flex; flex-wrap: wrap; gap: 30px; justify-content: center; margin-bottom: 50px;">
        <div
            style="flex: 1; min-width: 400px; max-width: 600px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <ul style="height: 300px; position: relative; margin: 0; padding: 0;">
                <!-- Simple wrapper for Chart.js responsiveness -->
                <canvas id="pmiChart"></canvas>
            </ul>
        </div>
        <div
            style="flex: 1; min-width: 400px; max-width: 600px; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
            <ul style="height: 300px; position: relative; margin: 0; padding: 0;">
                <canvas id="newOrdersChart"></canvas>
            </ul>
        </div>
    </div>

    <!-- Macro Chart -->
    <h2 style="margin-top: 40px;">Macro View: Manufacturing vs GDP</h2>
    <p style="text-align: center; color: #666; font-size: 0.9em; margin-bottom: 10px;">
        üí° <em>Scroll to zoom, drag to pan, double-click to reset</em>
    </p>
    <div
        style="max-width: 1000px; margin: 0 auto 50px auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
        <div style="height: 400px; position: relative;">
            <canvas id="macroChart"></canvas>
        </div>
        <p style="text-align: center; font-size: 0.9em; color: #666; margin-top: 10px;">
            *GDP Data source: FRED (Gross Domestic Product, Billions of Dollars). Quarterly data.
        </p>
    </div>

    <script>
        const months = ["Nov 2024", "Dec 2024", "Jan 2025", "Feb 2025", "Mar 2025", "Apr 2025", "May 2025", "Jun 2025", "Jul 2025", "Aug 2025", "Sep 2025", "Oct 2025", "Nov 2025", "Dec 2025"];

        const data = {
            "Apparel, Leather & Allied Products": [0, 0, 0, 0, 0, 1, 0, 1, 1, 2, -10, -11, -11, -15],
            "Chemical Products": [-9, -3, 4, 7, -3, 10, -2, -3, -8, -2, -6, -4, -5, -11],
            "Computer & Electronic Products": [2, 0, -3, -2, 5, 6, 0, 6, -4, -3, -1, -1, 4, 1],
            "Electrical Equipment, Appliances & Comp": [3, 2, 8, 6, 8, 4, 5, 9, -2, -4, -5, -5, 0, 2],
            "Fabricated Metal Products": [-6, -6, -5, 9, 3, -1, 6, -1, -5, -1, 4, 5, -7, -4],
            "Food, Beverage & Tobacco Products": [1, 0, -1, 5, -2, -3, -4, 8, -1, 4, 0, 2, 3, -2],
            "Furniture & Related Products": [-5, 4, -4, -5, -4, -5, 4, 5, 6, -6, -7, -10, -3, 0],
            "Machinery": [-4, -4, 5, -1, -1, 9, 7, 7, -7, -5, -2, -3, 1, -3],
            "Miscellaneous Manufacturing": [-2, 6, -7, 2, 9, 8, 0, 4, 5, 6, 5, -2, 2, -6],
            "Nonmetallic Mineral Products": [-3, -1, -8, -3, 6, 7, 2, 3, 3, 3, -3, 6, -4, -9],
            "Paper Products": [-8, 5, -2, 0, -6, -4, -7, -4, -9, -10, -8, -9, -9, -12],
            "Petroleum & Coal Products": [0, 0, 3, 1, 2, 2, 3, 2, 0, 5, 1, -6, -6, -8],
            "Plastics & Rubber Products": [-10, 7, 7, 8, -5, 3, 1, 0, 2, -8, -9, 4, -1, -5],
            "Primary Metals": [-1, 1, 2, 3, 4, 11, -1, 0, 7, 7, 2, 1, 0, -7],
            "Printing & Related Support Activities": [-11, -5, 0, 0, 0, 0, -5, 0, -10, 0, 0, -8, 0, -10],
            "Textile Mills": [0, -7, 1, -4, 1, 5, 0, -6, 4, 1, 3, -12, -8, -13],
            "Transportation Equipment": [-7, -2, 6, 10, 7, -2, -3, -2, -3, -7, -4, 3, -2, -1],
            "Wood Products": [0, 3, -6, 4, -7, -6, -6, -5, -6, -9, -11, -7, -10, -14]
        };



        // --- Transformation: Reverse Positive Ranks in First Table ---
        // User Request: "If it goes from +1 to +4 ... reverse the order."
        // We process each month (column). Find all positive values. Reverse their mapping.

        const numMonths = months.length;
        const industriesList = Object.keys(data);

        for (let i = 0; i < numMonths; i++) {
            // 1. Collect positive values for this month index `i`
            let positives = [];
            industriesList.forEach(ind => {
                const val = data[ind][i];
                if (val > 0) positives.push(val);
            });

            if (positives.length > 0) {
                // 2. Find min and max
                const maxVal = Math.max(...positives);
                const minVal = Math.min(...positives);

                // 3. Apply Reversal
                industriesList.forEach(ind => {
                    const val = data[ind][i];
                    if (val > 0) {
                        data[ind][i] = maxVal + minVal - val;
                    }
                });
            }
        }

        const headerRow = document.getElementById('headerRow');
        const tableBody = document.getElementById('tableBody');

        // Populate Heatmap Headers (Months)
        months.forEach(month => {
            const th = document.createElement('th');
            th.textContent = month;
            headerRow.appendChild(th);
        });

        function getColor(score) {
            if (score === 0) return '#ffff99';
            if (score > 0) {
                const intensity = Math.min(score / 12, 1);
                return `rgba(46, 204, 113, ${0.2 + (0.8 * intensity)})`;
            }
            if (score < 0) {
                const absScore = Math.abs(score);
                const intensity = Math.min(absScore / 12, 1);
                return `rgba(231, 76, 60, ${0.2 + (0.8 * intensity)})`;
            }
        }

        // Populate Heatmap Rows
        Object.keys(data).sort().forEach(industry => {
            const tr = document.createElement('tr');
            const nameTd = document.createElement('td');
            nameTd.className = 'industry-col';
            nameTd.textContent = industry;
            tr.appendChild(nameTd);

            data[industry].forEach(score => {
                const td = document.createElement('td');
                td.textContent = score > 0 ? `+${score}` : score;
                td.style.backgroundColor = getColor(score);
                if (Math.abs(score) > 8) td.style.color = 'white';
                tr.appendChild(td);
            });
            tableBody.appendChild(tr);
        });

        // --- ISM PMI Data (Pivoted) ---
        // Original Data (Descending Order in Markdown, so we Reverse it to map to Chronological Columns)
        // Data from Markdown: Nov 2025 (Index 0) -> Nov 2024 (Index 12)
        // We want columns: Nov 2024 -> Nov 2025

        const rawPmiData = [
            { date: "Dec 2025", pmi: 47.9, newOrders: 45.8, production: 45.8, employment: 44.9, supplierDel: 45.2, inv: 45.2, custInv: 0.0, prices: 45.8, backlog: 45.8, export: 44.6, imports: 44.6, trend: "Contraction" },
            { date: "Nov 2025", pmi: 48.2, newOrders: 44.0, production: 44.0, employment: 44.0, supplierDel: 48.9, inv: 48.9, custInv: 0.0, prices: 44.0, backlog: 44.0, export: 48.9, imports: 48.9, trend: "Contraction" },
            { date: "Oct 2025", pmi: 48.7, newOrders: 49.4, production: 48.2, employment: 46.0, supplierDel: 54.2, inv: 45.8, custInv: 43.9, prices: 58.0, backlog: 47.9, export: 44.5, imports: 45.4, trend: "Contraction" },
            { date: "Sep 2025", pmi: 49.1, newOrders: 48.9, production: 51.0, employment: 45.3, supplierDel: 52.6, inv: 47.7, custInv: 43.7, prices: 61.9, backlog: 46.2, export: 43.0, imports: 44.7, trend: "Contraction" },
            { date: "Aug 2025", pmi: 48.7, newOrders: 51.4, production: 47.8, employment: 43.8, supplierDel: 51.3, inv: 49.4, custInv: 43.0, prices: 63.7, backlog: 44.7, export: 47.6, imports: 46.0, trend: "Contraction" },
            { date: "Jul 2025", pmi: 48.0, newOrders: 47.1, production: 51.4, employment: 43.4, supplierDel: 49.3, inv: 48.9, custInv: 41.0, prices: 64.8, backlog: 46.8, export: 46.1, imports: 47.6, trend: "Contraction" },
            { date: "Jun 2025", pmi: 49.0, newOrders: 46.4, production: 50.3, employment: 45.0, supplierDel: 54.2, inv: 49.2, custInv: 46.7, prices: 69.7, backlog: 44.3, export: 46.3, imports: 47.4, trend: "Contraction" },
            { date: "May 2025", pmi: 48.5, newOrders: 47.6, production: 45.4, employment: 46.8, supplierDel: 56.1, inv: 46.7, custInv: 44.5, prices: 69.4, backlog: 47.1, export: 40.1, imports: 39.9, trend: "Contraction" },
            { date: "Apr 2025", pmi: 48.7, newOrders: 47.2, production: 44.0, employment: 46.5, supplierDel: 55.2, inv: 50.8, custInv: 46.2, prices: 69.8, backlog: 43.7, export: 43.1, imports: 47.1, trend: "Contraction" },
            { date: "Mar 2025", pmi: 49.0, newOrders: 45.2, production: 48.3, employment: 44.7, supplierDel: 53.5, inv: 53.4, custInv: 46.8, prices: 69.4, backlog: 44.5, export: 49.6, imports: 50.1, trend: "Contraction" },
            { date: "Feb 2025", pmi: 50.3, newOrders: 48.6, production: 50.7, employment: 47.6, supplierDel: 54.5, inv: 49.9, custInv: 45.3, prices: 62.4, backlog: 46.8, export: 51.4, imports: 52.6, trend: "Expansion" },
            { date: "Jan 2025", pmi: 50.9, newOrders: 55.1, production: 52.5, employment: 50.3, supplierDel: 50.9, inv: 45.9, custInv: 46.7, prices: 54.9, backlog: 44.9, export: 52.4, imports: 51.1, trend: "Expansion" },
            { date: "Dec 2024", pmi: 49.3, newOrders: 52.5, production: 50.3, employment: 45.3, supplierDel: 50.1, inv: 48.4, custInv: 46.7, prices: 52.5, backlog: 45.9, export: 50.0, imports: 49.7, trend: "Contraction" },
            { date: "Nov 2024", pmi: 48.4, newOrders: 50.4, production: 46.8, employment: 48.1, supplierDel: 48.7, inv: 48.1, custInv: 48.4, prices: 50.3, backlog: 41.8, export: 48.7, imports: 47.6, trend: "Contraction" }
        ];

        // Sort data chronologically: Nov 2024 -> Nov 2025
        const sortedPmiData = [...rawPmiData].reverse();

        const pmiHeaderRow = document.getElementById('pmiHeaderRow');
        const pmiBody = document.getElementById('pmiBody');

        // Populate PMI Headers (Dates)
        sortedPmiData.forEach(item => {
            const th = document.createElement('th');
            th.innerHTML = item.date.replace(' ', '<br>');
            th.className = 'date-header';
            pmiHeaderRow.appendChild(th);
        });

        // Define metrics (Rows)
        const metrics = [
            { key: 'pmi', label: 'Manufacturing PMI' },
            { key: 'newOrders', label: 'New Orders' },
            { key: 'production', label: 'Production' },
            { key: 'employment', label: 'Employment' },
            { key: 'supplierDel', label: 'Supplier Deliveries' },
            { key: 'inv', label: 'Inventories' },
            { key: 'custInv', label: 'Customer Inventories' },
            { key: 'prices', label: 'Prices' },
            { key: 'backlog', label: 'Backlog of Orders' },
            { key: 'export', label: 'New Export Orders' },
            { key: 'imports', label: 'Imports' },
            { key: 'trend', label: 'Overall Trend' }
        ];

        function getPmiColor(val) {
            if (val > 50) return 'rgba(46, 204, 113, 0.2)'; // Green tint
            if (val < 50) return 'rgba(231, 76, 60, 0.2)'; // Red tint
            return '#fff';
        }

        metrics.forEach(metric => {
            const tr = document.createElement('tr');

            // Metric Name Column
            const nameTd = document.createElement('td');
            nameTd.textContent = metric.label;
            nameTd.className = 'metric-col';
            tr.appendChild(nameTd);

            // Data Columns
            sortedPmiData.forEach(item => {
                const val = item[metric.key];
                const td = document.createElement('td');
                td.textContent = val;

                if (metric.key === 'trend') {
                    if (val.includes("Contraction")) td.className = 'trend-contraction';
                    else if (val.includes("Expansion")) td.className = 'trend-expansion';
                } else if (typeof val === 'number') {
                    td.style.backgroundColor = getPmiColor(val);
                }
                tr.appendChild(td);
            });
            pmiBody.appendChild(tr);
        });

        // --- New Orders Rank Data ---
        // Lists derived from ISM Reports (Nov 2024 - Nov 2025)
        // Order: Listed from Strongest Growth to Weakest Growth, and Strongest Decline to Weakest Decline?
        // User Rule: 
        // Growth: +1 for last one, +2 for one before it. (Implies list is Strongest -> Weakest. So First = +N, Last = +1)
        // Decline: -1 for last one, -2 for one before it. (Implies list is Strongest Decline -> Weakest Decline. So First = -N, Last = -1)

        const ranklists = {
            "Dec 2025": { growth: ["Computer & Electronic Products", "Electrical Equipment, Appliances & Comp"], decline: [] },
            "Nov 2025": { growth: ["Electrical Equipment, Appliances & Comp", "Computer & Electronic Products", "Machinery", "Miscellaneous Manufacturing", "Food, Beverage & Tobacco Products", "Primary Metals"], decline: [] },
            "Oct 2025": {
                growth: ["Primary Metals", "Plastics & Rubber Products", "Fabricated Metal Products", "Transportation Equipment"],
                decline: ["Apparel, Leather & Allied Products", "Textile Mills", "Paper Products", "Petroleum & Coal Products", "Furniture & Related Products", "Nonmetallic Mineral Products", "Miscellaneous Manufacturing", "Chemical Products", "Computer & Electronic Products", "Machinery", "Electrical Equipment, Appliances & Comp"]
            },
            "Sep 2025": {
                growth: ["Textile Mills", "Furniture & Related Products", "Fabricated Metal Products", "Miscellaneous Manufacturing", "Primary Metals", "Electrical Equipment, Appliances & Comp"],
                decline: ["Wood Products", "Nonmetallic Mineral Products", "Plastics & Rubber Products", "Paper Products", "Transportation Equipment", "Computer & Electronic Products", "Machinery", "Food, Beverage & Tobacco Products", "Chemical Products"]
            },
            "Aug 2025": {
                growth: ["Textile Mills", "Apparel, Leather & Allied Products", "Nonmetallic Mineral Products", "Food, Beverage & Tobacco Products", "Petroleum & Coal Products", "Miscellaneous Manufacturing", "Primary Metals"],
                decline: ["Paper Products", "Wood Products", "Plastics & Rubber Products", "Fabricated Metal Products", "Transportation Equipment", "Machinery"]
            },
            "Jul 2025": {
                growth: ["Apparel, Leather & Allied Products", "Plastics & Rubber Products", "Primary Metals", "Miscellaneous Manufacturing"],
                decline: ["Fabricated Metal Products"]
            },
            "Jun 2025": {
                growth: ["Apparel, Leather & Allied Products", "Petroleum & Coal Products", "Furniture & Related Products", "Nonmetallic Mineral Products", "Miscellaneous Manufacturing", "Food, Beverage & Tobacco Products", "Computer & Electronic Products"],
                decline: [] // Implicitly others declined
            },
            "May 2025": {
                growth: ["Plastics & Rubber Products", "Nonmetallic Mineral Products", "Petroleum & Coal Products", "Furniture & Related Products", "Electrical Equipment, Appliances & Comp", "Fabricated Metal Products", "Machinery"],
                decline: ["Paper Products", "Wood Products", "Food, Beverage & Tobacco Products", "Primary Metals", "Computer & Electronic Products", "Chemical Products", "Miscellaneous Manufacturing"]
            },
            "Apr 2025": {
                growth: ["Petroleum & Coal Products", "Machinery", "Computer & Electronic Products", "Chemical Products"],
                decline: ["Wood Products", "Paper Products", "Furniture & Related Products", "Transportation Equipment", "Nonmetallic Mineral Products", "Food, Beverage & Tobacco Products"]
            },
            "Mar 2025": {
                growth: ["Textile Mills", "Petroleum & Coal Products", "Fabricated Metal Products", "Primary Metals", "Computer & Electronic Products", "Nonmetallic Mineral Products", "Transportation Equipment", "Electrical Equipment, Appliances & Comp", "Miscellaneous Manufacturing"],
                decline: ["Wood Products", "Paper Products", "Plastics & Rubber Products", "Furniture & Related Products", "Chemical Products", "Food, Beverage & Tobacco Products", "Machinery"]
            },
            "Feb 2025": {
                growth: ["Petroleum & Coal Products", "Wood Products", "Electrical Equipment, Appliances & Comp", "Miscellaneous Manufacturing", "Primary Metals", "Machinery", "Fabricated Metal Products", "Food, Beverage & Tobacco Products", "Chemical Products"],
                decline: ["Furniture & Related Products", "Textile Mills", "Nonmetallic Mineral Products", "Computer & Electronic Products", "Plastics & Rubber Products"]
            },
            "Jan 2025": {
                growth: ["Textile Mills", "Primary Metals", "Petroleum & Coal Products", "Chemical Products", "Machinery", "Transportation Equipment", "Plastics & Rubber Products", "Electrical Equipment, Appliances & Comp"],
                decline: ["Nonmetallic Mineral Products", "Miscellaneous Manufacturing", "Wood Products", "Furniture & Related Products", "Food, Beverage & Tobacco Products"]
            },
            "Dec 2024": {
                growth: ["Primary Metals", "Electrical Equipment, Appliances & Comp", "Wood Products", "Furniture & Related Products", "Paper Products", "Miscellaneous Manufacturing", "Plastics & Rubber Products"],
                decline: ["Textile Mills", "Fabricated Metal Products", "Printing & Related Support Activities", "Machinery", "Chemical Products", "Transportation Equipment", "Nonmetallic Mineral Products"]
            },
            "Nov 2024": {
                growth: ["Food, Beverage & Tobacco Products", "Computer & Electronic Products", "Electrical Equipment, Appliances & Comp", "Machinery", "Miscellaneous Manufacturing", "Primary Metals"],
                decline: ["Printing & Related Support Activities", "Plastics & Rubber Products", "Chemical Products", "Paper Products", "Transportation Equipment", "Fabricated Metal Products", "Furniture & Related Products", "Nonmetallic Mineral Products"]
            }
        };

        // Normalize Name Function (Map variations to standard keys if needed)
        function normalizeName(name) {
            const map = {
                "Nonmetallic Minerals": "Nonmetallic Mineral Products",
                "Nonmetallic Mineral": "Nonmetallic Mineral Products",
                "Food, Beverage & Tobacco": "Food, Beverage & Tobacco Products",
                "Petroleum & Coal": "Petroleum & Coal Products",
                "Apparel": "Apparel, Leather & Allied Products",
                "Computer & Electronic": "Computer & Electronic Products",
                "Electrical Equipment": "Electrical Equipment, Appliances & Comp",
                "Furniture": "Furniture & Related Products",
                "Printing": "Printing & Related Support Activities"
            };
            return map[name] || name;
        }

        // Build Rank Data Table
        const rankTableBody = document.getElementById('rankTableBody');
        const rankHeaderRow = document.getElementById('rankHeaderRow');

        // 1. Populate Headers (Months) - reusing `months` array but transposed logic
        // We need columns Nov 24 -> Nov 25. The `months` array is Nov 24 -> Nov 25.
        months.forEach(month => {
            const th = document.createElement('th');
            th.innerHTML = month.replace(' ', '<br>');
            th.className = 'date-header';
            rankHeaderRow.appendChild(th);
        });

        // 2. Iterate Industries and Months to Calculate Scores
        const industries = Object.keys(data).sort();

        industries.forEach(industry => {
            const tr = document.createElement('tr');

            // Industry Name
            const nameTd = document.createElement('td');
            nameTd.className = 'industry-col';
            nameTd.textContent = industry;
            tr.appendChild(nameTd);

            // Loop through months (Nov 24 ... Nov 25)
            months.forEach(month => {
                const list = ranklists[month];
                let score = 0;

                if (list) {
                    // Check Growth
                    // Logic: +1 for last one, +2 for 2nd to last... 
                    // So if list is [A, B, C], C is +1, B is +2, A is +3.
                    // Index i (0 to N-1). Score = N - i.
                    const growthIdx = list.growth.findIndex(n => normalizeName(n) === industry);
                    if (growthIdx !== -1) {
                        score = list.growth.length - growthIdx;
                    }

                    // Check Decline
                    // Logic: -1 for last one, -2 for 2nd to last...
                    // So if list is [X, Y, Z], Z is -1, Y is -2, X is -3.
                    // Index i (0 to N-1). Score = -(N - i).
                    const declineIdx = list.decline.findIndex(n => normalizeName(n) === industry);
                    if (declineIdx !== -1) {
                        score = -(list.decline.length - declineIdx);
                    }
                }

                const td = document.createElement('td');
                td.textContent = score > 0 ? `+${score}` : score;
                td.style.backgroundColor = getColor(score); // Reusing getPmiColor logic? No, need heat scale.
                // Reusing `getColor` from Heatmap table which handles the gradient
                td.style.backgroundColor = getColor(score);
                if (Math.abs(score) > 8) td.style.color = 'white';
                tr.appendChild(td);
            });
            rankTableBody.appendChild(tr);
        });

        // --- Trend Charts (Added via Script) ---
        const ctxPmi = document.getElementById('pmiChart').getContext('2d');
        const ctxNewOrders = document.getElementById('newOrdersChart').getContext('2d');

        const dates = sortedPmiData.map(d => d.date);
        const pmiValues = sortedPmiData.map(d => d.pmi);
        const newOrdersValues = sortedPmiData.map(d => d.newOrders);

        // Chart common config
        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                title: {
                    display: true,
                    font: { size: 16, weight: 'bold' },
                    padding: { bottom: 20 }
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                }
            },
            scales: {
                y: {
                    beginAtZero: false,
                    grid: { color: '#f0f0f0' }
                },
                x: {
                    grid: { display: false }
                }
            },
            interaction: {
                mode: 'nearest',
                axis: 'x',
                intersect: false
            },
            plugins: {
                zoom: {
                    zoom: {
                        wheel: {
                            enabled: true,
                        },
                        pinch: {
                            enabled: true
                        },
                        mode: 'x',
                    },
                    pan: {
                        enabled: true,
                        mode: 'x',
                    },
                    limits: {
                        x: { min: 'original', max: 'original' },
                    }
                }
            }
        };

        // PMI Chart
        new Chart(ctxPmi, {
            type: 'line',
            data: {
                labels: dates,
                datasets: [
                    {
                        label: 'PMI',
                        data: pmiValues,
                        borderColor: '#2c3e50',
                        backgroundColor: 'rgba(44, 62, 80, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3,
                        pointBackgroundColor: pmiValues.map(v => v >= 50 ? '#2ecc71' : '#e74c3c'),
                        pointRadius: 4,
                        order: 1
                    },
                    {
                        label: 'Expansion Threshold (50)',
                        data: new Array(dates.length).fill(50),
                        borderColor: '#e74c3c',
                        borderWidth: 1,
                        borderDash: [6, 4],
                        pointRadius: 0,
                        fill: false,
                        order: 2,
                        hitRadius: 0, // Prevent hover interaction
                        hoverRadius: 0
                    }
                ]
            },
            options: {
                ...commonOptions,
                plugins: { ...commonOptions.plugins, title: { display: true, text: 'Manufacturing PMI Trend' } },
                scales: {
                    y: {
                        // Dynamic range with some padding
                        min: Math.floor(Math.min(...pmiValues) - 2),
                        max: Math.ceil(Math.max(...pmiValues) + 2),
                        grid: { color: '#f0f0f0' },
                        title: { display: true, text: 'Index Value' }
                    }
                }
            }
        });

        // New Orders Chart
        new Chart(ctxNewOrders, {
            type: 'line',
            data: {
                labels: dates,
                datasets: [
                    {
                        label: 'New Orders',
                        data: newOrdersValues,
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.3,
                        pointBackgroundColor: newOrdersValues.map(v => v >= 50 ? '#2ecc71' : '#e74c3c'),
                        pointRadius: 4,
                        order: 1
                    },
                    {
                        label: 'Expansion Threshold (50)',
                        data: new Array(dates.length).fill(50),
                        borderColor: '#e74c3c',
                        borderWidth: 1,
                        borderDash: [6, 4],
                        pointRadius: 0,
                        fill: false,
                        order: 2,
                        hitRadius: 0,
                        hoverRadius: 0
                    }
                ]
            },
            options: {
                ...commonOptions,
                plugins: { ...commonOptions.plugins, title: { display: true, text: 'New Orders Trend' } },
                scales: {
                    y: {
                        min: Math.floor(Math.min(...newOrdersValues) - 2),
                        max: Math.ceil(Math.max(...newOrdersValues) + 2),
                        grid: { color: '#f0f0f0' },
                        title: { display: true, text: 'Index Value' }
                    }
                }
            }
        });

        // --- Macro Chart (GDP Growth Rate vs PMI) ---
        // Extended to show 3 years of historical data
        const ctxMacro = document.getElementById('macroChart').getContext('2d');

        // Create 3-year date range (Nov 2022 - Nov 2025)
        const macroDates = [
            "Nov 2022", "Dec 2022",
            "Jan 2023", "Feb 2023", "Mar 2023", "Apr 2023", "May 2023", "Jun 2023",
            "Jul 2023", "Aug 2023", "Sep 2023", "Oct 2023", "Nov 2023", "Dec 2023",
            "Jan 2024", "Feb 2024", "Mar 2024", "Apr 2024", "May 2024", "Jun 2024",
            "Jul 2024", "Aug 2024", "Sep 2024", "Oct 2024", "Nov 2024", "Dec 2024",
            "Jan 2025", "Feb 2025", "Mar 2025", "Apr 2025", "May 2025", "Jun 2025",
            "Jul 2025", "Aug 2025", "Sep 2025", "Oct 2025", "Nov 2025"
        ];

        // Historical GDP Growth Rate Data (Quarterly, % Change SAAR)
        // Source: https://fred.stlouisfed.org/series/A191RL1Q225SBEA
        // Will be auto-updated by update_gdp_data.py script
        const gdpMapExtended = {
            // 2022
            "Nov 2022": 3.2, "Dec 2022": 3.2, // Q4 2022
            // 2023
            "Jan 2023": 2.6, "Feb 2023": 2.6, "Mar 2023": 2.6, // Q1 2023
            "Apr 2023": 2.2, "May 2023": 2.2, "Jun 2023": 2.2, // Q2 2023
            "Jul 2023": 2.1, "Aug 2023": 2.1, "Sep 2023": 2.1, // Q3 2023
            "Oct 2023": 4.9, "Nov 2023": 4.9, "Dec 2023": 4.9, // Q4 2023
            // 2024
            "Jan 2024": 1.4, "Feb 2024": 1.4, "Mar 2024": 1.4, // Q1 2024
            "Apr 2024": 3.0, "May 2024": 3.0, "Jun 2024": 3.0, // Q2 2024
            "Jul 2024": 2.8, "Aug 2024": 2.8, "Sep 2024": 2.8, // Q3 2024
            "Oct 2024": 3.1, "Nov 2024": 3.1, "Dec 2024": 3.1, // Q4 2024
            // 2025
            "Jan 2025": 2.3, "Feb 2025": 2.3, "Mar 2025": 2.3, // Q1 2025 (estimated)
            "Apr 2025": 2.8, "May 2025": 2.8, "Jun 2025": 2.8, // Q2 2025 (estimated)
            "Jul 2025": null, "Aug 2025": null, "Sep 2025": null, // Q3 2025 Pending
            "Oct 2025": null, "Nov 2025": null
        };

        // Historical PMI Data (monthly)
        // Source: ISM Manufacturing PMI
        const pmiMapExtended = {
            // 2022
            "Nov 2022": 49.0, "Dec 2022": 48.4,
            // 2023
            "Jan 2023": 47.4, "Feb 2023": 47.7, "Mar 2023": 46.3, "Apr 2023": 47.1, "May 2023": 46.9, "Jun 2023": 46.0,
            "Jul 2023": 46.4, "Aug 2023": 47.6, "Sep 2023": 49.0, "Oct 2023": 46.7, "Nov 2023": 46.7, "Dec 2023": 47.4,
            // 2024
            "Jan 2024": 49.1, "Feb 2024": 47.8, "Mar 2024": 50.3, "Apr 2024": 49.2, "May 2024": 48.7, "Jun 2024": 48.5,
            "Jul 2024": 46.8, "Aug 2024": 47.2, "Sep 2024": 47.2, "Oct 2024": 46.5, "Nov 2024": 48.4, "Dec 2024": 49.3,
            // 2025
            "Jan 2025": 50.9, "Feb 2025": 50.3, "Mar 2025": 49.0, "Apr 2025": 48.7, "May 2025": 48.5, "Jun 2025": 49.0,
            "Jul 2025": 48.0, "Aug 2025": 48.7, "Sep 2025": 49.1, "Oct 2025": 48.7, "Nov 2025": 48.2
        };

        const gdpValuesExtended = macroDates.map(d => gdpMapExtended[d] !== undefined ? gdpMapExtended[d] : null);
        const pmiValuesExtended = macroDates.map(d => pmiMapExtended[d] !== undefined ? pmiMapExtended[d] : null);

        new Chart(ctxMacro, {
            type: 'line',
            data: {
                labels: macroDates,
                datasets: [
                    {
                        label: 'Real GDP Growth Rate (% SAAR)',
                        data: gdpValuesExtended,
                        borderColor: '#2980b9', // Strong Blue
                        backgroundColor: 'rgba(41, 128, 185, 0.1)',
                        borderWidth: 3,
                        yAxisID: 'y1',
                        fill: false,
                        tension: 0.4,
                        pointRadius: 4,
                        pointBackgroundColor: '#2980b9',
                        order: 2
                    },
                    {
                        label: 'Manufacturing PMI',
                        data: pmiValuesExtended,
                        borderColor: '#2c3e50', // Dark Slate
                        backgroundColor: 'rgba(44, 62, 80, 0.1)',
                        borderWidth: 3,
                        borderDash: [5, 5], // Dashed to differentiate index
                        fill: false,
                        tension: 0.3,
                        yAxisID: 'y',
                        pointRadius: 4,
                        pointBackgroundColor: '#2c3e50',
                        order: 1
                    }
                ]
            },
            options: {
                ...commonOptions,
                plugins: {
                    ...commonOptions.plugins,
                    title: { display: true, text: 'Macro Context: GDP Growth Rate vs Manufacturing PMI' },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                        callbacks: {
                            label: function (context) {
                                let label = context.dataset.label || '';
                                if (label) {
                                    label += ': ';
                                }
                                if (context.parsed.y !== null) {
                                    if (context.datasetIndex === 0) return label + context.parsed.y + '%';
                                    return label + context.parsed.y;
                                }
                                return label;
                            }
                        }
                    }
                },
                scales: {
                    x: {
                        grid: { display: false }
                    },
                    y: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        title: { display: true, text: 'PMI Index' },
                        min: 40,
                        max: 60
                    },
                    y1: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        title: { display: true, text: 'GDP Growth Rate (%)' },
                        grid: { display: false },
                        // Tighter scale to show variations better
                        min: 0,
                        max: 6
                    }
                }
            }
        });


    </script>
</body>

</html>